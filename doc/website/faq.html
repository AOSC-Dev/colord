<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>colord - Frequently Asked Questions</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link rel="stylesheet" href="style.css" type="text/css" media="screen"/>
<link rel="shortcut icon" href="favicon.ico"/>
</head>
<body>

<p>Back to the <a href="index.html">main page</a></p>

<h1>Frequently asked questions</h1>

<h2>Table Of Contents</h2>
<ul>
<li><a href="#spelling">Can I type colord with leading upper case 'C'?</a></li>
<li><a href="#gcm">How does this work with gnome-color-manager?</a></li>
<li><a href="#xrandr13">Are XRandr 1.2 devices still supported?</a></li>
<li><a href="#imageloading">Does colord or GNOME Color Manager convert my image?</a></li>
<li><a href="#whydbnotxml">Why are the mappings stored in a database, not readable XML files?</a></li>
<!--
<li><a href="#xxx">xxx</a></li>
-->
<li><a href="#sensors">What is a native sensor?</a></li>
<li><a href="#application">How would an application like Simple Scan use colord?</a></li>
<li><a href="#qualifiers">What is a qualifier used for?</a></li>
<li><a href="#daemon">How do system daemons add devices and profiles?</a></li>
<li><a href="#cups">How would a system daemon like CUPS use colord?</a></li>
<li><a href="#translation">How do I translate gnome-color-manager?</a></li>
<li><a href="#corporate-sponsor">Is there an organization sponsoring development of colord?</a></li>
</ul>

<hr/>
<h3><a name="spelling">Can I type colord with leading upper case 'C'</a></h3>
<p>
No.
</p>

<hr/>
<h3><a name="gcm">How does this work with gnome-color-manager?</a></h3>
<p>
At startup GCM has to create profiles, devices and otherwise act as the
helper agent for colord in that user session.
GNOME Color Manager basically has to do the following 6 things:
</p>
<ul>
<li>
 Call <code>CreateDevice</code> for each connected XRandr screen and
 watch for changes to the screen.
</li>
<li>
 Create an ICC profile file for each Xrandr device using the EDID
 primary information and store it in the home directory.
</li>
<li>
 Call <code>CreateProfile</code> for each profile found in the home
 directory.</li>
<li>
 For each <code>::profile-added</code> event check if the
 <code>EDID_md5</code> metadata matches any Xrandr devices.
 If it does, then it needs to call <code>Device.AddProfile()</code>
</li>
<li>
 For each <code>::device-added</code> event check if the device
 <code>modified</code> property is beyong a set threshold.
 If it is, show a notification that the user should calibrate the device.
</li>
<li>
 For each <code>::device-added</code> event from a Xrandr device,
 get the default profile and push the gamma ramp to the X output.
</li>
</ul>


<hr/>
<h3><a name="xrandr13">Are XRandr 1.2 devices still supported?</a></h3>
<p>
No. Xrandr 1.3 is required to do per-output gamma correction.
</p>

<hr/>
<h3><a name="imageloading">Does colord or GNOME Color Manager convert my image?</a></h3>
<p>
No. You need to use a pixel conversion library, for instance
<a href="http://www.littlecms.com/">lcms2</a>.
</p>

<hr/>
<h3><a name="whydbnotxml">Why are the mappings stored in a database, not readable XML files?</a></h3>
<p>
If you have a registry that more than one program is changing, you
<b>need</b> locking.
Locking with plain files is neither fun nor reliable.
From a raw performance point of view, it's two order of magnitudes
faster to mmap a single 20k sqlite .db file than it is to read 200
small XML files from the filesystem.
</p>
<p>
The session needs to <b>query</b> things like <i>give me all the
profiles for device $foo</i> and <i>find all the devices that use
profile $bar</i> which is why we should be using a database, rather than
searching discrete files on the filesystem every time the session asks
for data.
</p>
<p>
If we're <i>exchanging</i> files between users, then single files do
start to make sense.
I don't personally see a use case where I want to exchange low level
device->profile settings data with somebody else.
A chain of settings from document to printer would be a very useful
thing, but this is what you generate for a process and ship, rather
than copy from the filesystem unchanged.
</p>
<p>
Having power users <i>tweaking</i> the mapping is something that does
not make good design.
These people can use the <code>colormgr</code> command line client to
add and remove mappings, and to append qualifiers to certain profiles in
a safe abstracted way.
</p>

<!--
<hr/>
<h3><a name="xxxxxxxxxxxxxxxxxxxxxxxxxxx">ccccccccccccccccccccccccccccccc</a></h3>
<p>
ccccccccccccccccccccccccccccccccccccccccccccccccccccc.
</p>
-->

<hr/>
<h3><a name="sensors">What is a native sensor?</a></h3>
<p>
A native sensor is a calibration device such as a colorimeter or
photospectrometer that colord knows how to interface with.
</p>
<p>
Many sensor makes and models are recognised, and are available to be used
by programs such as <a href="http://www.argyllcms.com/">Argll CMS</a>.
Only the <a href="http://www.pantone.co.uk/pages/products/product.aspx?pid=562">Pantone Huey</a>
device is available for use in colord by default, as colord contains a
native driver for this device.
</p>
<p>
A native driver allows colord to lock the device, read a sample from the
sensors (or from the ambient light sensor) and unlock the device.
A native device allows client programs to get samples from the device
trivially using either raw DBus or libcolord without relying on external
programs.
</p>
<p>
The author is also working on a Pantone ColorMunki native driver and
other hardware can supported if it is sent to the developer, or if
specifications can be obtained.
Email me if you can help.
</p>

<hr/>
<h3><a name="qualifiers">What is a qualifier used for?</a></h3>
<p>
A qualifier is a single string with three substrings joined with dots.
For example, <code>RGB.Glossy.300dpi</code> would be the qualifier on
a profile for a RGB device, printing on glossy paper and at 300 dots-per-inch.
</p>
<p>
Qualifiers are assigned to a profile either by CUPS itself or by the user
and this allows CUPS to choose the correct profile for a given print job.
The substrings are tried in preference order, so that for a print job
of type <code>RGB.Glossy.300dpi</code> the following fallbacks would be
used:
</p>
<ol>
<li><code>RGB.Glossy.300dpi</code></li>
<li><code>RGB.Glossy.*</code></li>
<li><code>RGB.*.300dpi</code></li>
<li><code>RGB.*.*</code></li>
<li><code>*</code></li>
</ol>
<p>
The fallback scheme allows one profile to potentially match lots of
different print conditions, as very few users will have more than
a couple of different printer profiles.
</p>
<p>
The tri-dotted notation was chosen in preference to JSOn or XML as it
is <a href="http://www.cups.org/documentation.php/doc-1.4/spec-ppd.html#cupsICCProfile">
already being used by CUPS</a> in the cupsICCProfile PPD Extensions
format.
</p>

<hr/>
<h3><a name="application">How would an application like Simple Scan use colord?</a></h3>
<p>
It's actually really easy.
Simple Scan already knows the <code>SANE_Device</code> object of the
scanner that it wants to use.
From the <code>SANE_Device</code> object we can easily get the
<i>device_id</i> for the color managed device in colord.
To do this, refer to the <a href="http://gitorious.org/colord/master/blobs/master/doc/device-and-profile-naming-spec.txt">
device and profile specification</a> for scanner devices.
This specifies the <i>device_id</i> for a sane device is made up from
<code>"sane_" + sane_device->model</code>.
</p>
<p>
We can now query colord using <a href="http://colord.hughsie.com/api/">
libcolord</a> for the device that matches this ID:
</p>
<pre>
    CdClient *client = NULL;
    CdDevice *device = NULL;
    CdProfile *profile = NULL;
    GError *error = NULL;

    /* create a connection to colord */
    client = cd_client_new ();

    /* find the device for a specific ID */
    device = cd_client_find_device_sync (client, device_id, NULL, &amp;error);
    if (device == NULL) {
        g_warning ("failed to find a device in colord: %s,
                   error->message);
        g_error_free (error);
        goto out;
    }

    /* get the default profile for this device */
    profile = cd_device_get_default_profile (device);
    if (profile == NULL)
        goto out;

    /* TODO: use lcms to convert the scanned image */
    g_message ("need to use: %s", cd_profile_get_filename (profile));
out:
    if (profile != NULL)
        g_object_unref (profile);
    if (device != NULL)
        g_object_unref (device);
    g_object_unref (client);
</pre>
<p>
If you're not happy gaining an additional dependency of libcolord, then
it's also pretty easy to use raw DBus calls to do the same thing.
See the <a href="http://gitorious.org/colord/master/trees/master/examples">
examples</a> folder for some code samples.
</p>

<hr/>
<h3><a name="daemon">How do system daemons add devices and profiles?</a></h3>
<p>
Like this:
</p>
<pre>
    for device in self.devices:
        o = CreateDevice(device.name)
        for profile in device.profiles:
            p = AddProfile(profile.id)
            if profile.icc_filename:
                p.SetFilename(profile.icc_filename)
            p.SetQualifier(profile.qualifier)
            o.AddProfile(p)
</pre>

<hr/>
<h3><a name="cups">How would a system daemon like CUPS use colord?</a></h3>
<p>
Like this:
</p>
<pre>
    d = FindDeviceById(device.name)
    if d:
        p = d.GetProfileForQualifier(qualifier)
        if p:
            p.Use()
</pre>

<hr/>
<h3><a name="translation">How do I translate gnome-color-manager?</a></h3>
<p>
See the <a href="http://l10n.gnome.org/teams">GNOME Translation Team</a>
web pages for how to contribute to GNOME localisation.
</p>

<hr/>
<h3><a name="corporate-sponsor">Is there an organization or corporation sponsoring development of colord?</a></h3>
<p>
colord is not sponsored by anyone, although Red Hat gives me the time to
work on random open source projects. Thanks!
</p>

<p>Back to the <a href="index.html">main page</a></p>

<p class="footer">
 Copyright <a href="mailto:richard@hughsie.com">Richard Hughes 2011</a><br/>
 <a href="http://validator.w3.org/check/referer">Optimized</a>
 for <a href="http://www.w3.org/">standards</a>.
</p>

</body>
</html>

